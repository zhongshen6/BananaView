
<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Mod 聚合器</title>
  <!-- 原子化样式加载序列 -->
  <link rel="stylesheet" href="/mod/static/css/base.css">
  <link rel="stylesheet" href="/mod/static/css/layout.css">
  <link rel="stylesheet" href="/mod/static/css/components.css">
  <link rel="stylesheet" href="/mod/static/css/card.css">
  <link rel="stylesheet" href="/mod/static/css/detail.css">
</head>
<body>
  <div class="app">
    <header class="topbar" role="banner">
      <!-- Logo -->
      <a class="logo" href="/mod/" onclick="event.preventDefault(); window.dispatchEvent(new CustomEvent('go-home'));">
        <img src="/mod/static/logo.png" alt="Logo" class="logo-img">
        <div>
          <div class="title">GameBanana</div>
          <div style="font-size:12px; color:var(--muted);">现代 • 清晰 • 流畅</div>
        </div>
      </a>

      <!-- 控件：设置按钮 -->
      <div class="controls">
        <div class="dropdown">
          <button id="menuBtn" class="btn dropdown-toggle" data-label="推荐内容">推荐内容 ▼</button>
          <div class="dropdown-menu hidden" id="menuList">
            <button class="dropdown-item" data-action="recommended">推荐内容</button>
            <button class="dropdown-item" data-action="latest">最新发布</button>
            <button class="dropdown-item" data-action="updated">最近更新</button>
            <button class="dropdown-item" data-action="subscriptions">订阅内容</button>
          </div>
        </div>
        <button id="settingsBtn" class="btn" title="设置">⚙️</button>
      </div>
    </header>

    <!-- 瀑布流容器 -->
    <main id="mods" aria-live="polite"></main>
    <div id="loader" class="loader">正在加载…</div>
    <div id="sentinel"></div>
  </div>

  <!-- 详情页全屏遮罩层 (SPA 核心) -->
  <div id="detailOverlay" class="detail-overlay hidden">
    <div id="detailLoading" class="loading-overlay">
        <div class="spinner"></div>
    </div>
    <div class="hero-bg" id="heroBg"></div>
    <div class="detail-container">
        <header class="nav-header">
            <button id="closeDetail" class="back-btn">← 返回列表</button>
        </header>
        <div id="detailMainContent" style="display:none;">
            <section class="gallery-section">
                <div id="mainImgContainer" class="main-img-container"></div>
                <div class="thumb-list" id="thumbList"></div>
            </section>
            <div class="content-grid">
                <main>
                    <div class="glass-card mod-header">
                        <h1 id="modName">加载中...</h1>
                        <div class="mod-stats">
                            <span title="发布日期">📅 <span id="addDate"></span></span>
                            <span title="浏览量">👁️ <span id="viewCount"></span></span>
                            <span title="喜欢">❤️ <span id="likeCount"></span></span>
                            <span title="下载量">💾 <span id="dlCount"></span></span>
                        </div>
                        <div class="description-text" id="modDescription"></div>
                    </div>
                    <div class="glass-card" id="reqSection" style="display:none;">
                        <span class="side-title">前置要求 / Requirements</span>
                        <div class="req-list" id="reqList"></div>
                    </div>
                    <div class="glass-card">
                        <span class="side-title">文件列表 / Files</span>
                        <div id="fileList"></div>
                        <a href="#" class="download-btn" id="mainDownloadBtn" target="_blank">在 GameBanana 官网查看详情</a>
                    </div>
                    <!-- 新增：许可证板块 -->
                    <div class="glass-card" id="licenseSection" style="display:none; font-size: 0.8rem; opacity: 0.8;">
                        <span class="side-title">许可证 / License</span>
                        <div id="licenseInfo"></div>
                    </div>
                </main>
                <aside>
                    <div class="glass-card author-card">
                        <span class="side-title">发布者 / Submitter</span>
                        <div class="avatar-wrap">
                            <img id="authorAvatar" class="avatar" src="https://images.gamebanana.com/img/av/default.png" alt="Avatar">
                            <div id="onlineStatus" class="online-dot"></div>
                        </div>
                        <a id="authorName" href="#" target="_blank" class="author-name">Author</a>
                        <div id="authorTitle" style="font-size: 0.8rem; color: var(--muted); margin-bottom: 10px;"></div>
                        <div class="medals-wall" id="medalsWall"></div>
                        <!-- 新增：作者简介板块 -->
                        <div id="bioSection" style="display:none; margin-top: 20px; text-align: left; border-top: 1px solid rgba(0,0,0,0.05); padding-top: 15px;">
                            <span class="side-title">作者简介 / Bio</span>
                            <div id="authorBio" style="font-size: 0.8rem; color: #4b5563;"></div>
                        </div>
                    </div>
                    <!-- 新增：使用软件板块 -->
                    <div class="glass-card" id="softwareSection" style="display:none;">
                        <span class="side-title">使用软件 / Software Used</span>
                        <div class="tags-container" id="softwareTags"></div>
                    </div>
                    <div class="glass-card">
                        <span class="side-title">所属游戏 / Game</span>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <img id="gameIcon" src="" width="28" height="28" style="border-radius:6px;">
                            <span id="gameName" style="font-weight: 600; font-size: 0.9rem;"></span>
                        </div>
                    </div>
                </aside>
            </div>
        </div>
    </div>
  </div>

  <!-- 设置窗口 -->
  <div id="settingsModal" class="settings-modal hidden">
    <div class="settings-content">
      <div class="settings-header">
        <h3>设置</h3>
        <button id="closeSettings" class="close-btn">✕</button>
      </div>
      <div class="settings-body">
        <div class="setting-item">
            <span class="setting-label">缩略图质量</span>
            <div class="slider-container" id="thumbQualitySlider">
                <div class="slider-option" data-value="220">低</div>
                <div class="slider-option" data-value="530">高</div>
                <div class="slider-thumb"></div>
            </div>
        </div>
        <div class="setting-item">
            <span class="setting-label">列数</span>
            <div class="slider-container" id="columnCountSlider">
                <div class="slider-option" data-value="0">多列</div>
                <div class="slider-option" data-value="1">单列</div>
                <div class="slider-thumb"></div>
            </div>
        </div>
        <div class="setting-item">
            <span class="setting-label">内容筛选</span>
            <div class="slider-container" id="contentFilterSlider">
                <div class="slider-option" data-value="all">全部</div>
                <div class="slider-option" data-value="mods">模组</div>
                <div class="slider-option" data-value="posts">帖子</div>
                <div class="slider-thumb"></div>
            </div>
        </div>
        <div class="setting-item">
            <span class="setting-label">NSFW 内容显示</span>
            <div class="slider-container" id="nsfwSlider">
                <div class="slider-option" data-value="show">显示</div>
                <div class="slider-option" data-value="blur">模糊</div>
                <div class="slider-option" data-value="hide">隐藏</div>
                <div class="slider-option" data-value="only">仅限</div>
                <div class="slider-thumb"></div>
            </div>
        </div>
        <div class="setting-item">
          <span class="setting-label">用户ID</span>
          <div style="display:flex; align-items:center; gap:8px; flex:1;">
            <input id="userIdInput" type="text" pattern="\d*" placeholder="请输入数字ID" style="flex:1;">
            <button id="howToBtn" class="info-btn"> ？</button>
          </div>
        </div>
      </div>
      <span id="healthDot" class="status-dot"></span>
    </div>
  </div>

  <!-- 使用说明弹出窗口 (已移至最外层防止 clipping) -->
  <div id="howToPopover" class="popover hidden">
    <div class="popover-content">
      <h4>获取用户ID</h4>
      <p>在 GameBanana 登录后，打开以下链接，找到类似 <code>/members/123456</code> 的数字，即为 ID。</p>
      <div class="popover-images">
        <img src="static/id_example.png" alt="示例图">
        <img src="static/id_example-2.png" alt="示例图">
      </div>
      <div class="popover-footer">
        <a href="https://gamebanana.com/members/account/login" target="_blank" rel="noreferrer" class="btn-popover secondary">去登录</a>
        <a href="https://gamebanana.com/apiv11/Member/Navigator/Personal" target="_blank" rel="noreferrer" class="btn-popover">获取ID</a>
      </div>
    </div>
  </div>

  <div id="toastContainer" class="toast-container"></div>
  <button id="backTop" aria-label="回到顶部" title="回到顶部">↑</button>

  <script type="module" src="/mod/static/js/main.js"></script>
</body>
</html>
